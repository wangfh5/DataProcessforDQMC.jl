<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>鲁棒离群值筛选（IQR fence） · DataProcessforDQMC.jl</title><meta name="title" content="鲁棒离群值筛选（IQR fence） · DataProcessforDQMC.jl"/><meta property="og:title" content="鲁棒离群值筛选（IQR fence） · DataProcessforDQMC.jl"/><meta property="twitter:title" content="鲁棒离群值筛选（IQR fence） · DataProcessforDQMC.jl"/><meta name="description" content="Documentation for DataProcessforDQMC.jl."/><meta property="og:description" content="Documentation for DataProcessforDQMC.jl."/><meta property="twitter:description" content="Documentation for DataProcessforDQMC.jl."/><meta property="og:url" content="https://wangfh5.github.io/DataProcessforDQMC.jl/robust_outlier_filtering/"/><meta property="twitter:url" content="https://wangfh5.github.io/DataProcessforDQMC.jl/robust_outlier_filtering/"/><link rel="canonical" href="https://wangfh5.github.io/DataProcessforDQMC.jl/robust_outlier_filtering/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DataProcessforDQMC.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../precompilation/">预编译指南</a></li><li><a class="tocitem" href="../bin_analysis/">Bin Analysis与数据处理指南</a></li><li><a class="tocitem" href="../structure_factor_analysis/">结构因子分析设计</a></li><li><a class="tocitem" href="../multi_parameter_analysis/">多参数分析指南</a></li><li class="is-active"><a class="tocitem" href>鲁棒离群值筛选（IQR fence）</a><ul class="internal"><li><a class="tocitem" href="#1.-问题：为什么普通-mean/std-会被极端离群值污染？"><span>1. 问题：为什么普通 mean/std 会被极端离群值污染？</span></a></li><li><a class="tocitem" href="#2.-IQR-与-Tukey-fence（箱线图规则）"><span>2. IQR 与 Tukey fence（箱线图规则）</span></a></li><li><a class="tocitem" href="#3.-“很宽松的-fence（k10）”是什么意思？"><span>3. “很宽松的 fence（k=10）”是什么意思？</span></a></li><li><a class="tocitem" href="#4.-鲁棒-mean/std（在过滤后集合上计算）"><span>4. 鲁棒 mean/std（在过滤后集合上计算）</span></a></li><li><a class="tocitem" href="#5.-边界条件与工程化细节"><span>5. 边界条件与工程化细节</span></a></li><li><a class="tocitem" href="#6.-与“dropmaxmin”剪裁的关系"><span>6. 与“dropmaxmin”剪裁的关系</span></a></li><li><a class="tocitem" href="#7.-诊断指标：删了多少点？"><span>7. 诊断指标：删了多少点？</span></a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>鲁棒离群值筛选（IQR fence）</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>鲁棒离群值筛选（IQR fence）</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/wangfh5/DataProcessforDQMC.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/wangfh5/DataProcessforDQMC.jl/blob/main/docs/src/robust_outlier_filtering.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="鲁棒离群值筛选：IQR-fence-与鲁棒均值/方差（数学说明）"><a class="docs-heading-anchor" href="#鲁棒离群值筛选：IQR-fence-与鲁棒均值/方差（数学说明）">鲁棒离群值筛选：IQR fence 与鲁棒均值/方差（数学说明）</a><a id="鲁棒离群值筛选：IQR-fence-与鲁棒均值/方差（数学说明）-1"></a><a class="docs-heading-anchor-permalink" href="#鲁棒离群值筛选：IQR-fence-与鲁棒均值/方差（数学说明）" title="Permalink"></a></h1><p>本文档聚焦于一种在统计物理/蒙特卡洛数据分析中非常常见的鲁棒统计策略：</p><ul><li>用 <strong>Tukey 的 IQR fence</strong>（四分位距栅栏）剔除极端离群值；</li><li>在剩余样本上计算均值/标准差，得到对“极少数异常点”不敏感的统计量。</li></ul><p>典型应用场景包括：</p><ul><li>binning 后的统计量仍残留偶发 spike；</li><li>bootstrap/重采样的拟合参数分布中，极少数迭代落入不物理的局部极小值（例如临界点 <code>Tc</code> 跑到远离数据范围的负数），导致普通 mean/std 被严重“污染”。</li></ul><h2 id="1.-问题：为什么普通-mean/std-会被极端离群值污染？"><a class="docs-heading-anchor" href="#1.-问题：为什么普通-mean/std-会被极端离群值污染？">1. 问题：为什么普通 mean/std 会被极端离群值污染？</a><a id="1.-问题：为什么普通-mean/std-会被极端离群值污染？-1"></a><a class="docs-heading-anchor-permalink" href="#1.-问题：为什么普通-mean/std-会被极端离群值污染？" title="Permalink"></a></h2><p>给定一组样本：</p><p>$</p><p>{x<em>i}</em>{i=1}^n\subset\mathbb{R}, $</p><p>普通样本均值与样本标准差为</p><p>$</p><p>\bar{x}=\frac{1}{n}\sum<em>{i=1}^n x</em>i,\qquad s=\sqrt{\frac{1}{n-1}\sum<em>{i=1}^n (x</em>i-\bar{x})^2}. $</p><p>当存在极少数 <span>$|x_i|$</span> 极大的离群点时：</p><ul><li><p class="math-container">\[\bar{x}\]</p>会向离群点方向明显偏移；</li><li><p class="math-container">\[s\]</p>会被离群点的平方项放大，导致误差条失真。</li></ul><p>这类“离群点”往往不是物理分布的真实尾部，而是算法层面的异常：例如某一次拟合收敛到不物理局部极小值。</p><h2 id="2.-IQR-与-Tukey-fence（箱线图规则）"><a class="docs-heading-anchor" href="#2.-IQR-与-Tukey-fence（箱线图规则）">2. IQR 与 Tukey fence（箱线图规则）</a><a id="2.-IQR-与-Tukey-fence（箱线图规则）-1"></a><a class="docs-heading-anchor-permalink" href="#2.-IQR-与-Tukey-fence（箱线图规则）" title="Permalink"></a></h2><h3 id="2.1-四分位数与-IQR"><a class="docs-heading-anchor" href="#2.1-四分位数与-IQR">2.1 四分位数与 IQR</a><a id="2.1-四分位数与-IQR-1"></a><a class="docs-heading-anchor-permalink" href="#2.1-四分位数与-IQR" title="Permalink"></a></h3><p>定义第一/第三四分位数（25% 与 75% 分位）：</p><p>$</p><p>Q<em>1 = \mathrm{Quantile}</em>{0.25}({x<em>i}),\qquad Q</em>3 = \mathrm{Quantile}<em>{0.75}({x</em>i}). $</p><p>四分位距（interquartile range, IQR）：</p><p>$</p><p>\mathrm{IQR} = Q<em>3 - Q</em>1. $</p><p>IQR 的特点：</p><ul><li>仅由中间 50% 的样本决定，对极端尾部天然不敏感；</li><li>因此常被用来构建鲁棒的离群值判据。</li></ul><h3 id="2.2-Tukey-fence"><a class="docs-heading-anchor" href="#2.2-Tukey-fence">2.2 Tukey fence</a><a id="2.2-Tukey-fence-1"></a><a class="docs-heading-anchor-permalink" href="#2.2-Tukey-fence" title="Permalink"></a></h3><p>给定倍数 <span>$k&gt;0$</span>，定义下/上栅栏（fence）：</p><p>$</p><p>L = Q<em>1 - k\,\mathrm{IQR},\qquad U = Q</em>3 + k\,\mathrm{IQR}. $</p><p>保留位于区间 <span>$[L,U]$</span> 内的样本集合：</p><p>$</p><p>S = {x<em>i\mid L\le x</em>i\le U}. $</p><p>把 <span>$S$</span> 之外的点视为离群值并剔除。</p><h2 id="3.-“很宽松的-fence（k10）”是什么意思？"><a class="docs-heading-anchor" href="#3.-“很宽松的-fence（k10）”是什么意思？">3. “很宽松的 fence（k=10）”是什么意思？</a><a id="3.-“很宽松的-fence（k10）”是什么意思？-1"></a><a class="docs-heading-anchor-permalink" href="#3.-“很宽松的-fence（k10）”是什么意思？" title="Permalink"></a></h2><p>经典箱线图中，常见的经验值是：</p><ul><li><p class="math-container">\[k=1.5\]</p>：mild outliers（温和离群）</li><li><p class="math-container">\[k=3\]</p>：extreme outliers（极端离群）</li></ul><p>在 bootstrap 拟合参数分布中，我们通常不希望“清洗正常波动”，而只想去掉<strong>极少数极端不物理解</strong>。</p><p>因此可以选取一个非常大的 <span>$k$</span>（例如 <span>$k=10$</span>）：</p><ul><li>对正常统计波动而言，fence 会非常宽，几乎不会删点；</li><li>但对于像 <code>Tc=-8.6</code> 这种远离主体分布的点，仍会被剔除。</li></ul><h3 id="3.1-正态分布量纲解释（近似）"><a class="docs-heading-anchor" href="#3.1-正态分布量纲解释（近似）">3.1 正态分布量纲解释（近似）</a><a id="3.1-正态分布量纲解释（近似）-1"></a><a class="docs-heading-anchor-permalink" href="#3.1-正态分布量纲解释（近似）" title="Permalink"></a></h3><p>若样本近似来自正态分布 <span>$x\sim\mathcal{N}(\mu,\sigma^2)$</span>，则</p><ul><li><p class="math-container">\[Q_1\approx \mu-0.674\sigma\]</p></li><li><p class="math-container">\[Q_3\approx \mu+0.674\sigma\]</p></li><li><p class="math-container">\[\mathrm{IQR}\approx 1.349\sigma\]</p></li></ul><p>因此</p><p>$</p><p>L\approx \mu-(0.674+1.349k)\sigma,\qquad U\approx \mu+(0.674+1.349k)\sigma. $</p><p>当 <span>$k=10$</span> 时，fence 大约覆盖</p><p>$</p><p>\mu\pm 14.16\sigma. $</p><p>这几乎不会删除正态分布的真实样本，但能有效屏蔽“算法性离群点”。</p><h2 id="4.-鲁棒-mean/std（在过滤后集合上计算）"><a class="docs-heading-anchor" href="#4.-鲁棒-mean/std（在过滤后集合上计算）">4. 鲁棒 mean/std（在过滤后集合上计算）</a><a id="4.-鲁棒-mean/std（在过滤后集合上计算）-1"></a><a class="docs-heading-anchor-permalink" href="#4.-鲁棒-mean/std（在过滤后集合上计算）" title="Permalink"></a></h2><p>对过滤后的集合 <span>$S$</span>（样本数 <span>$|S|$</span>），定义鲁棒统计量：</p><p>$</p><p>\bar{x}<em>{\mathrm{robust}}=\frac{1}{|S|}\sum</em>{x\in S} x, \qquad s<em>{\mathrm{robust}}=\sqrt{\frac{1}{|S|-1}\sum</em>{x\in S}(x-\bar{x}_{\mathrm{robust}})^2}. $</p><p>这样做的关键点是：</p><ul><li>过滤步骤用 IQR 构造边界（鲁棒）；</li><li>均值/方差步骤在主体样本上计算（仍保持与传统误差条的直观对应）。</li></ul><h2 id="5.-边界条件与工程化细节"><a class="docs-heading-anchor" href="#5.-边界条件与工程化细节">5. 边界条件与工程化细节</a><a id="5.-边界条件与工程化细节-1"></a><a class="docs-heading-anchor-permalink" href="#5.-边界条件与工程化细节" title="Permalink"></a></h2><p>在实际代码中，通常会加入一些保护条件以避免“过度处理”：</p><ol><li><strong>忽略非有限值</strong>：先丢弃 <code>NaN/Inf</code>（以及可选的 <code>missing</code>）。</li><li><strong>样本数阈值</strong>：当 <span>$n&lt; n_{\min}$</span> 时不做 fence（例如 <span>$n_{\min}=8$</span>），因为分位数不稳定。</li><li><strong>IQR=0</strong>：若 <span>$\mathrm{IQR}=0$</span>，说明样本几乎退化为常数，此时 fence 无意义，跳过过滤。</li><li><strong>过滤后为空则回退</strong>：若 fence 导致 <span>$S=\varnothing$</span>，回退到原样本（宁可不删，也不人为制造偏差）。</li></ol><h2 id="6.-与“dropmaxmin”剪裁的关系"><a class="docs-heading-anchor" href="#6.-与“dropmaxmin”剪裁的关系">6. 与“dropmaxmin”剪裁的关系</a><a id="6.-与“dropmaxmin”剪裁的关系-1"></a><a class="docs-heading-anchor-permalink" href="#6.-与“dropmaxmin”剪裁的关系" title="Permalink"></a></h2><p>另一种常见做法是排序后直接去掉最小/最大若干个值（trim）：</p><ul><li><code>dropmaxmin=1</code> 等价于删除最小值与最大值各 1 个。</li></ul><p>它与 IQR fence 的区别：</p><ul><li>trim 的删除量固定（与分布形状无关）；</li><li>IQR fence 的删除量自适应（由分布主体的 IQR 决定）。</li></ul><p>在“极少数极端离群点”的场景下，IQR fence 往往更合适：</p><ul><li>不需要手动指定要删几个点；</li><li>如果没有明显离群点，通常不会删点。</li></ul><h2 id="7.-诊断指标：删了多少点？"><a class="docs-heading-anchor" href="#7.-诊断指标：删了多少点？">7. 诊断指标：删了多少点？</a><a id="7.-诊断指标：删了多少点？-1"></a><a class="docs-heading-anchor-permalink" href="#7.-诊断指标：删了多少点？" title="Permalink"></a></h2><p>实务上建议同时输出：</p><ul><li>原始分布的 <code>min, Q1, median, Q3, max</code></li><li>过滤后的 <code>mean_robust, std_robust</code></li><li><code>N_removed = n - |S|</code></li></ul><p>若你发现 <code>N_removed</code> 很大（例如远超过个位数），往往意味着：</p><ul><li>分布严重多峰（拟合对初值很敏感），或</li><li>jitter 半径过大导致大量跑偏，或</li><li>拟合窗口/模型假设与数据不匹配。</li></ul><p>这时更应优先调整拟合策略（窗口/jitter/模型）而不是继续“更激进地删点”。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../multi_parameter_analysis/">« 多参数分析指南</a><a class="docs-footer-nextpage" href="../api/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 30 January 2026 07:36">Friday 30 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
